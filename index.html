<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pensionskassen-Rechner für Jugendliche</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        h1, h2 { color: #333; }
        form { margin-bottom: 20px; }
        label { display: block; margin-top: 10px; }
        input, select { margin-bottom: 10px; padding: 5px; width: 200px; }
        button { background-color: #4CAF50; border: none; color: white; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer; }
        #result-section { background-color: #f2f2f2; padding: 20px; border-radius: 5px; }
        .chart-container { width: 80%; margin: 20px auto; }
        fieldset { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; }
        .salary-info { margin-top: 10px; font-style: italic; color: #666; }
        .hidden { display: none; }
        .checkbox-group { margin-left: 20px; }
    </style>
</head>
<body>
    <header>
        <h1>Deine Zukunft, deine Pension</h1>
    </header>
    
    <main>
        <section id="input-section">
            <h2>Deine Daten</h2>
            <form id="pension-form">
                <label for="age">Dein Alter:</label>
                <input type="number" id="age" name="age" required>
                
                <label for="retirement-age">Geplantes Pensionsalter:</label>
                <input type="number" id="retirement-age" name="retirement-age" required>
                
                <fieldset>
                    <legend>Wähle deine Lohndaten:</legend>
                    <div>
                        <input type="radio" id="preset-salary" name="salary-type" value="preset">
                        <label for="preset-salary">Vorgegebene Beispiele</label>
                    </div>
                    <div>
                        <input type="radio" id="custom-salary" name="salary-type" value="custom">
                        <label for="custom-salary">Eigene Eingabe</label>
                    </div>
                </fieldset>
                
                <div id="salary-info" class="salary-info hidden">
                    Hier kommt ein erklärender Text zur Auswahl der Lohndaten. Dieser Text sollte dem Benutzer helfen zu verstehen, wie die Wahl der Lohndaten die Berechnungen beeinflusst.
                </div>
                
                <div id="preset-salary-options" class="hidden">
                    <div class="checkbox-group">
                        <input type="checkbox" id="example1" name="salary-preset" value="example1">
                        <label for="example1">Beispiel 1: Kaufmann / Kauffrau (5100 - 7240 CHF)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="example2" name="salary-preset" value="example2">
                        <label for="example2">Beispiel 2: Informatiker / Informatikerin (5840 - 9530 CHF)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="example3" name="salary-preset" value="example3">
                        <label for="example3">Beispiel 3: Schreiner / Schreinerin (3800 - 7500 CHF)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="example4" name="salary-preset" value="example4">
                        <label for="example4">Beispiel 4: Krankenpfleger / Krankenpflegerin in (4200 - 8500 CHF)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="example5" name="salary-preset" value="example5">
                        <label for="example5">Beispiel 5: Lehrer / Lehrerin (5000 - 9500 CHF)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="example6" name="salary-preset" value="example6">
                        <label for="example6">Beispiel 6: Polymechaniker / Polymechanikerin (5490 - 8470 CHF)</label>
                    </div>
                </div>
                
                <div id="custom-salary-inputs" class="hidden">
                    <label for="start-salary">Einstiegslohn (CHF/Monat):</label>
                    <input type="number" id="start-salary" name="start-salary" min="2000">
                    
                    <label for="end-salary">Erwarteter Endlohn (CHF/Monat):</label>
                    <input type="number" id="end-salary" name="end-salary" min="2000">
                </div>
                
                <button type="submit">Berechnen</button>
            </form>
        </section>
        
        <section id="result-section" style="display: none;">
            <h2>Deine Pensionskasse</h2>
            <div class="chart-container">
                <canvas id="salary-savings-chart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="pension-comparison-chart"></canvas>
            </div>
            <div id="summary">
                <h3>Zusammenfassung</h3>
                <p>Angespartes Kapital: <span id="total-capital"></span> CHF</p>
                <h4>Monatliche Rente:</h4>
                <ul>
                    <li>Mit 6.8% Umwandlungssatz: <span id="monthly-pension-68"></span> CHF</li>
                    <li>Mit 6.0% Umwandlungssatz: <span id="monthly-pension-60"></span> CHF</li>
                </ul>
                <h4>Jährliche Rente:</h4>
                <ul>
                    <li>Mit 6.8% Umwandlungssatz: <span id="yearly-pension-68"></span> CHF</li>
                    <li>Mit 6.0% Umwandlungssatz: <span id="yearly-pension-60"></span> CHF</li>
                </ul>
            </div>
        </section>
    </main>
    
    <footer>
        <p>© 2024 Pensionskassen-Rechner. Alle Angaben ohne Gewähr.</p>
    </footer>

    <script>
    // Constants
    const INFLATION_RATE = 0.01; // 1% annual inflation
    const BVG_RATES = {
        '25-34': 0.07,
        '35-44': 0.10,
        '45-54': 0.15,
        '55-64': 0.18
    };

    let salaryChart, pensionChart;

    // Main calculation function
    function calculatePensionSavings(startAge, retirementAge, startSalary, endSalary) {
        let totalSavings = 0;
        let currentSalary = startSalary;
        const yearsWorking = retirementAge - startAge;
        const annualSalaryIncrease = (endSalary - startSalary) / yearsWorking;

        for (let age = startAge; age < retirementAge; age++) {
            const bvgRate = getBVGRate(age);
            const yearlyContribution = currentSalary * bvgRate * 12; // 12 months
            totalSavings += yearlyContribution;

            // Inflation adjustment and salary increase for the next year
            currentSalary = (currentSalary + annualSalaryIncrease) * (1 + INFLATION_RATE);
            totalSavings *= (1 + INFLATION_RATE); // Savings are also adjusted for inflation
        }

        return totalSavings;
    }

    // Helper function to determine BVG rate based on age
    function getBVGRate(age) {
        if (age < 25) return 0;
        if (age >= 25 && age <= 34) return BVG_RATES['25-34'];
        if (age >= 35 && age <= 44) return BVG_RATES['35-44'];
        if (age >= 45 && age <= 54) return BVG_RATES['45-54'];
        if (age >= 55) return BVG_RATES['55-64'];
    }

    // Function to calculate monthly pension
    function calculateMonthlyPension(totalSavings, conversionRate) {
        const yearlyPension = totalSavings * conversionRate;
        return yearlyPension / 12;
    }

    // Function to update charts
    function updateCharts(startAge, retirementAge, startSalary, endSalary, totalSavings) {
        updateSalaryAndSavingsChart(startAge, retirementAge, startSalary, endSalary, totalSavings);
        updatePensionComparisonChart(totalSavings);
    }

    // Function to update salary and savings chart
    function updateSalaryAndSavingsChart(startAge, retirementAge, startSalary, endSalary, totalSavings) {
        const labels = [];
        const salaryData = [];
        const savingsData = [];
        const yearsWorking = retirementAge - startAge;
        const annualSalaryIncrease = (endSalary - startSalary) / yearsWorking;
        let currentSalary = startSalary;
        let currentSavings = 0;

        for (let age = startAge; age <= retirementAge; age++) {
            labels.push(age);
            salaryData.push(currentSalary * 12);  // Annual salary
            savingsData.push(currentSavings);

            const bvgRate = getBVGRate(age);
            const yearlyContribution = currentSalary * bvgRate * 12;
            currentSavings += yearlyContribution;

            currentSalary += annualSalaryIncrease;
            currentSalary *= (1 + INFLATION_RATE);
            currentSavings *= (1 + INFLATION_RATE);
        }

        if (salaryChart) {
            salaryChart.destroy();
        }

        salaryChart = new Chart(document.getElementById('salary-savings-chart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Jahresgehalt',
                    data: salaryData,
                    borderColor: 'blue',
                    fill: false
                }, {
                    label: 'Angespartes Kapital',
                    data: savingsData,
                    borderColor: 'green',
                    backgroundColor: 'rgba(0, 255, 0, 0.2)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Alter'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'CHF'
                        },
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Function to update pension comparison chart
    function updatePensionComparisonChart(totalSavings) {
        const monthlyPension68 = calculateMonthlyPension(totalSavings, 0.068);
        const monthlyPension60 = calculateMonthlyPension(totalSavings, 0.060);

        if (pensionChart) {
            pensionChart.destroy();
        }

        pensionChart = new Chart(document.getElementById('pension-comparison-chart'), {
            type: 'bar',
            data: {
                labels: ['Monatliche Rente', 'Jährliche Rente'],
                datasets: [{
                    label: '6.8% Umwandlungssatz',
                    data: [monthlyPension68, monthlyPension68 * 12],
                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                    borderColor: 'rgb(255, 99, 132)',
                    borderWidth: 1
                }, {
                    label: '6.0% Umwandlungssatz',
                    data: [monthlyPension60, monthlyPension60 * 12],
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgb(54, 162, 235)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'CHF'
                        }
                    }
                }
            }
        });
    }

    // Function to get preset salaries
    function getPresetSalaries(preset) {
        const presets = {
            'example1': [5100, 7240],
            'example2': [5840, 9530],
            'example3': [3800, 7500],
            'example4': [4200, 8500],
            'example5': [5000, 9500],
            'example6': [5490, 8470]
        };
        return presets[preset];
    }

    // Function to update results in the UI
    function updateResults(totalSavings, age, retirementAge, startSalary, endSalary) {
        document.getElementById('total-capital').textContent = totalSavings.toFixed(2);
        document.getElementById('monthly-pension-68').textContent = calculateMonthlyPension(totalSavings, 0.068).toFixed(2);
        document.getElementById('monthly-pension-60').textContent = calculateMonthlyPension(totalSavings, 0.060).toFixed(2);
        document.getElementById('yearly-pension-68').textContent = (calculateMonthlyPension(totalSavings, 0.068) * 12).toFixed(2);
        document.getElementById('yearly-pension-60').textContent = (calculateMonthlyPension(totalSavings, 0.060) * 12).toFixed(2);

        document.getElementById('result-section').style.display = 'block';
        updateCharts(age, retirementAge, startSalary, endSalary, totalSavings);
    }

    // Function to show/hide salary options based on user selection
    function toggleSalaryOptions() {
        const presetRadio = document.getElementById('preset-salary');
        const customRadio = document.getElementById('custom-salary');
        const presetOptions = document.getElementById('preset-salary-options');
        const customInputs = document.getElementById('custom-salary-inputs');
        const salaryInfo = document.getElementById('salary-info');

        if (presetRadio.checked) {
            presetOptions.classList.remove('hidden');
            customInputs.classList.add('hidden');
            salaryInfo.classList.remove('hidden');
        } else if (customRadio.checked) {
            presetOptions.classList.add('hidden');
            customInputs.classList.remove('hidden');
            salaryInfo.classList.remove('hidden');
        } else {
            presetOptions.classList.add('hidden');
            customInputs.classList.add('hidden');
            salaryInfo.classList.add('hidden');
        }
    }

    // Add event listeners for salary type selection
    document.getElementById('preset-salary').addEventListener('change', toggleSalaryOptions);
    document.getElementById('custom-salary').addEventListener('change', toggleSalaryOptions);

    // Update the event listener for form submission
    document.getElementById('pension-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const age = parseInt(document.getElementById('age').value);
        const retirementAge = parseInt(document.getElementById('retirement-age').value);
        let startSalary, endSalary;

        if (document.getElementById('preset-salary').checked) {
            const checkedExample = document.querySelector('input[name="salary-preset"]:checked');
            if (checkedExample) {
                [startSalary, endSalary] = getPresetSalaries(checkedExample.value);
            } else {
                alert('Bitte wählen Sie ein Beispiel aus.');
                return;
            }
        } else if (document.getElementById('custom-salary').checked) {
            startSalary = parseInt(document.getElementById('start-salary').value);
            endSalary = parseInt(document.getElementById('end-salary').value);
            if (isNaN(startSalary) || isNaN(endSalary)) {
                alert('Bitte geben Sie gültige Werte für den Einstiegs- und Endlohn ein.');
                return;
            }
        } else {
            alert('Bitte wählen Sie eine Lohnoption aus.');
            return;
        }

        const totalSavings = calculatePensionSavings(age, retirementAge, startSalary, endSalary);
        updateResults(totalSavings, age, retirementAge, startSalary, endSalary);
    });

    // Initialize the form
    toggleSalaryOptions();
    </script>
</body>
</html>
