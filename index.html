<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pensionskassen-Rechner für Jugendliche</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Deine Zukunft, deine Pension</h1>
    </header>
    
    <main>
        <section id="input-section">
            <h2>Deine Daten</h2>
            <form id="pension-form">
                <label for="age">Dein Alter:</label>
                <input type="number" id="age" name="age" min="15" max="20" required>
                
                <fieldset>
                    <legend>Wähle deine Lohndaten:</legend>
                    <input type="radio" id="preset-salary" name="salary-type" value="preset" checked>
                    <label for="preset-salary">Vorgegebene Beispiele</label>
                    
                    <input type="radio" id="custom-salary" name="salary-type" value="custom">
                    <label for="custom-salary">Eigene Eingabe</label>
                </fieldset>
                
                <div id="preset-salary-options">
                    <label for="salary-preset">Wähle ein Beispiel:</label>
                    <select id="salary-preset" name="salary-preset">
                        <option value="example1">Beispiel 1: Kaufmann (4000 - 8000 CHF)</option>
                        <option value="example2">Beispiel 2: Informatikerin (4500 - 10000 CHF)</option>
                        <option value="example3">Beispiel 3: Schreiner (3800 - 7500 CHF)</option>
                        <option value="example4">Beispiel 4: Krankenpflegerin (4200 - 8500 CHF)</option>
                        <option value="example5">Beispiel 5: Lehrer (5000 - 9500 CHF)</option>
                    </select>
                </div>
                
                <div id="custom-salary-inputs" style="display: none;">
                    <label for="start-salary">Einstiegslohn (CHF/Monat):</label>
                    <input type="number" id="start-salary" name="start-salary" min="2000" max="10000">
                    
                    <label for="end-salary">Erwarteter Endlohn (CHF/Monat):</label>
                    <input type="number" id="end-salary" name="end-salary" min="2000" max="20000">
                </div>
                
                <label for="retirement-age">Geplantes Pensionsalter:</label>
                <input type="number" id="retirement-age" name="retirement-age" min="58" max="70" required>
                
                <button type="submit">Berechnen</button>
            </form>
        </section>
        
        <section id="result-section" style="display: none;">
            <h2>Deine Pensionskasse</h2>
            <div id="chart-container">
                <canvas id="pension-chart"></canvas>
            </div>
            <div id="summary">
                <h3>Zusammenfassung</h3>
                <p>Angespartes Kapital: <span id="total-capital"></span> CHF</p>
                <h4>Monatliche Rente:</h4>
                <ul>
                    <li>Mit 6.8% Umwandlungssatz: <span id="monthly-pension-68"></span> CHF</li>
                    <li>Mit 6.0% Umwandlungssatz: <span id="monthly-pension-60"></span> CHF</li>
                </ul>
                <h4>Jährliche Rente:</h4>
                <ul>
                    <li>Mit 6.8% Umwandlungssatz: <span id="yearly-pension-68"></span> CHF</li>
                    <li>Mit 6.0% Umwandlungssatz: <span id="yearly-pension-60"></span> CHF</li>
                </ul>
            </div>
            <div id="chart-container">
                <canvas id="salary-savings-chart"></canvas>
                <canvas id="pension-comparison-chart"></canvas>
            </div>
        </section>
    </main>
    
    <footer>
        <p>© 2024 Pensionskassen-Rechner. Alle Angaben ohne Gewähr.</p>
    </footer>

    <script>
    // Konstanten
    const INFLATION_RATE = 0.01; // 1% jährliche Inflation
    const BVG_RATES = {
        '25-34': 0.07,
        '35-44': 0.10,
        '45-54': 0.15,
        '55-64': 0.18
    };

    // Hauptfunktion zur Berechnung des Pensionskassenguthabens
    function calculatePensionSavings(startAge, retirementAge, startSalary, endSalary) {
        let totalSavings = 0;
        let currentSalary = startSalary;
        const yearsWorking = retirementAge - startAge;
        const annualSalaryIncrease = (endSalary - startSalary) / yearsWorking;

        for (let age = startAge; age < retirementAge; age++) {
            const bvgRate = getBVGRate(age);
            const yearlyContribution = currentSalary * bvgRate * 12; // 12 Monate
            totalSavings += yearlyContribution;

            // Inflationsanpassung und Lohnanstieg für das nächste Jahr
            currentSalary = (currentSalary + annualSalaryIncrease) * (1 + INFLATION_RATE);
            totalSavings *= (1 + INFLATION_RATE); // Auch die Ersparnisse werden der Inflation angepasst
        }

        return totalSavings;
    }

    // Hilfsfunktion zur Bestimmung des BVG-Satzes basierend auf dem Alter
    function getBVGRate(age) {
        if (age < 25) return 0;
        if (age >= 25 && age <= 34) return BVG_RATES['25-34'];
        if (age >= 35 && age <= 44) return BVG_RATES['35-44'];
        if (age >= 45 && age <= 54) return BVG_RATES['45-54'];
        if (age >= 55) return BVG_RATES['55-64'];
    }

    // Funktion zur Berechnung der monatlichen Rente
    function calculateMonthlyPension(totalSavings, conversionRate) {
        const yearlyPension = totalSavings * conversionRate;
        return yearlyPension / 12;
    }

    // Event-Listener für das Formular
    document.getElementById('pension-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const age = parseInt(document.getElementById('age').value);
        const retirementAge = parseInt(document.getElementById('retirement-age').value);
        let startSalary, endSalary;

        if (document.getElementById('preset-salary').checked) {
            const preset = document.getElementById('salary-preset').value;
            [startSalary, endSalary] = getPresetSalaries(preset);
        } else {
            startSalary = parseInt(document.getElementById('start-salary').value);
            endSalary = parseInt(document.getElementById('end-salary').value);
        }

        const totalSavings = calculatePensionSavings(age, retirementAge, startSalary, endSalary);
        updateResults(totalSavings);
    });

    // Funktion zum Abrufen vorgegebener Gehälter
    function getPresetSalaries(preset) {
        const presets = {
            'example1': [4000, 8000],
            'example2': [4500, 10000],
            'example3': [3800, 7500],
            'example4': [4200, 8500],
            'example5': [5000, 9500]
        };
        return presets[preset];
    }

    // Funktion zur Aktualisierung der Ergebnisse in der UI
    function updateResults(totalSavings) {
        document.getElementById('total-capital').textContent = totalSavings.toFixed(2);
        document.getElementById('monthly-pension-68').textContent = calculateMonthlyPension(totalSavings, 0.068).toFixed(2);
        document.getElementById('monthly-pension-60').textContent = calculateMonthlyPension(totalSavings, 0.060).toFixed(2);
        document.getElementById('yearly-pension-68').textContent = (calculateMonthlyPension(totalSavings, 0.068) * 12).toFixed(2);
        document.getElementById('yearly-pension-60').textContent = (calculateMonthlyPension(totalSavings, 0.060) * 12).toFixed(2);

        document.getElementById('result-section').style.display = 'block';
        updateChart(totalSavings);
        updateCharts(age, retirementAge, startSalary, endSalary, totalSavings);
    }

    // Funktion zur Aktualisierung des Diagramms
    function updateChart(totalSavings) {
        // Hier können Sie den Code für die Aktualisierung des Chart.js-Diagramms einfügen
        // Dies hängt von der genauen Art des Diagramms ab, das Sie anzeigen möchten
    }

    // Zusätzliche Event-Listener für die Umschaltung zwischen vorgegebenen und benutzerdefinierten Gehältern
    document.getElementById('preset-salary').addEventListener('change', function() {
        document.getElementById('preset-salary-options').style.display = 'block';
        document.getElementById('custom-salary-inputs').style.display = 'none';
    });

    document.getElementById('custom-salary').addEventListener('change', function() {
        document.getElementById('preset-salary-options').style.display = 'none';
        document.getElementById('custom-salary-inputs').style.display = 'block';
    });
    let salaryChart, pensionChart;
    
    function updateCharts(startAge, retirementAge, startSalary, endSalary, totalSavings) {
        updateSalaryAndSavingsChart(startAge, retirementAge, startSalary, endSalary, totalSavings);
        updatePensionComparisonChart(totalSavings);
    }
    
    function updateSalaryAndSavingsChart(startAge, retirementAge, startSalary, endSalary, totalSavings) {
        const labels = [];
        const salaryData = [];
        const savingsData = [];
        const yearsWorking = retirementAge - startAge;
        const annualSalaryIncrease = (endSalary - startSalary) / yearsWorking;
        let currentSalary = startSalary;
        let currentSavings = 0;
    
        for (let age = startAge; age <= retirementAge; age++) {
            labels.push(age);
            salaryData.push(currentSalary * 12);  // Jahresgehalt
            savingsData.push(currentSavings);
    
            const bvgRate = getBVGRate(age);
            const yearlyContribution = currentSalary * bvgRate * 12;
            currentSavings += yearlyContribution;
    
            currentSalary += annualSalaryIncrease;
            currentSalary *= (1 + INFLATION_RATE);
            currentSavings *= (1 + INFLATION_RATE);
        }
    
        if (salaryChart) {
            salaryChart.destroy();
        }
    
        salaryChart = new Chart(document.getElementById('salary-savings-chart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Jahresgehalt',
                    data: salaryData,
                    borderColor: 'blue',
                    fill: false
                }, {
                    label: 'Angespartes Kapital',
                    data: savingsData,
                    borderColor: 'green',
                    backgroundColor: 'rgba(0, 255, 0, 0.2)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Alter'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'CHF'
                        },
                        beginAtZero: true
                    }
                }
            }
        });
    }
    
    function updatePensionComparisonChart(totalSavings) {
        const monthlyPension68 = calculateMonthlyPension(totalSavings, 0.068);
        const monthlyPension60 = calculateMonthlyPension(totalSavings, 0.060);
    
        if (pensionChart) {
            pensionChart.destroy();
        }
    
        pensionChart = new Chart(document.getElementById('pension-comparison-chart'), {
            type: 'bar',
            data: {
                labels: ['Monatliche Rente', 'Jährliche Rente'],
                datasets: [{
                    label: '6.8% Umwandlungssatz',
                    data: [monthlyPension68, monthlyPension68 * 12],
                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                    borderColor: 'rgb(255, 99, 132)',
                    borderWidth: 1
                }, {
                    label: '6.0% Umwandlungssatz',
                    data: [monthlyPension60, monthlyPension60 * 12],
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgb(54, 162, 235)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'CHF'
                        }
                    }
                }
            }
        });    
    </script>
</body>
</html>
